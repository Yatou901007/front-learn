<!doctype html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>瀑布流</title>
    <script type="text/javascript">
      window.onload = function(){
        imgLocation('container','box');
        var imgData = {
          data: [{"src": 'falls/1.jpg'},{"src": 'falls/2.jpg'},{"src": 'falls/3.jpg'},{"src": 'falls/4.jpg'},{"src": 'falls/5.jpg'},{"src": 'falls/6.jpg'},{"src": 'falls/7.jpg'},{"src": 'falls/8.jpg'}]
        };
        window.onscroll = function(){
          if (checkflag()){
            var cparent = document.getElementById("container");
            for (var i = 0; i < imgData.data.length; i++) {
              var cchild = document.createElement('div');
              cchild.className = "box";
              cparent.appendChild(cchild);
              var boximg = document.createElement('div');
              boximg.className = "box_img";
              cchild.appendChild(boximg)
              var img = document.createElement('img');
              img.src = "image/" + imgData.data[i].src;
              boximg.appendChild(img);
            };
            imgLocation('container','box');
          }
        }
      }

      function checkflag() {
        var cparent = document.getElementById("container");
        var cchild = getChildElement(cparent,'box');
        var lastChildHeight = cchild[cchild.length -1].offsetTop;
        var scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
        var pageHeight = document.documentElement.clientHeight || document.body.clientHeight;
        // console.log(lastChildHeight,scrollTop,pageHeight,scrollTop + pageHeight);
        if(lastChildHeight < scrollTop + pageHeight) {
          return true;
        }
      }

      function imgLocation(parent,content) {
        var cparent = document.getElementById(parent);
        var cchild = getChildElement(cparent,content);
        var imgWidth = cchild[0].offsetWidth;
        var count  = Math.floor(document.body.clientWidth / imgWidth);
        cparent.style.cssText = "width:" + imgWidth * count + "px;"

        var boxheightarr = [];
        for (var i = 0; i < cchild.length; i++) {
          if (i < count) {
            boxheightarr.push(cchild[i].offsetHeight);
          } else {
            var minheight = Math.min.apply(null, boxheightarr);
            cchild[i].style.position = "absolute";
            cchild[i].style.top = minheight + 'px';
            var minIndex = getMinHeightLoction(boxheightarr, minheight);
            cchild[i].style.left = cchild[minIndex].offsetLeft + 'px';
            // console.log(boxheightarr, minheight, minIndex)

            boxheightarr[minIndex] = boxheightarr[minIndex] + cchild[i].offsetHeight;
            // console.log(cchild[i].offsetHeight)
          }
          
        };
      }
      function getMinHeightLoction(boxheightarr, minheight) {
        for (var i in boxheightarr) {
          if (boxheightarr[i] == minheight) {
            return i;
          }
        };
      }
      function getChildElement(parent,content) {
          var arr = [];
          var allcontent = parent.getElementsByTagName("*");
          for (var i = 0; i < allcontent.length; i++) {
            if (allcontent[i].className == content) {
              arr.push(allcontent[i]);
            }
            
          };
          return arr;
      }
    </script>
    <style type="text/css">
      *{padding: 0;margin:0;}
      #container {
        margin: auto;
        overflow: hidden;
      }
      .box {
        padding: 5px;
        float: left;
      }
      .box_img {
        padding: 5px;
        border: 1px solid #ccc;
        border-radius: 4px;
        box-shadow: 0 0 4px #ccc;
      }
      .box_img img{
        width: 150px;
        height: auto;
      }
    </style>
</head>
<body>
    <div id="container">
      <div class="box">
        <div class="box_img">
          <img src="image/falls/0.jpg">
        </div>
      </div>
      <div class="box">
        <div class="box_img">
          <img src="image/falls/1.jpg">
        </div>
      </div>
      <div class="box">
        <div class="box_img">
          <img src="image/falls/2.jpg">
        </div>
      </div>
      <div class="box">
        <div class="box_img">
          <img src="image/falls/3.jpg">
        </div>
      </div>
      <div class="box">
        <div class="box_img">
          <img src="image/falls/4.jpg">
        </div>
      </div>
      <div class="box">
        <div class="box_img">
          <img src="image/falls/5.jpg">
        </div>
      </div>
      <div class="box">
        <div class="box_img">
          <img src="image/falls/6.jpg">
        </div>
      </div>
      <div class="box">
        <div class="box_img">
          <img src="image/falls/7.jpg">
        </div>
      </div>
      <div class="box">
        <div class="box_img">
          <img src="image/falls/8.jpg">
        </div>
      </div>
      <div class="box">
        <div class="box_img">
          <img src="image/falls/9.jpg">
        </div>
      </div>
      <div class="box">
        <div class="box_img">
          <img src="image/falls/10.jpg">
        </div>
      </div>
      <div class="box">
        <div class="box_img">
          <img src="image/falls/0.jpg">
        </div>
      </div>
      <div class="box">
        <div class="box_img">
          <img src="image/falls/1.jpg">
        </div>
      </div>
      <div class="box">
        <div class="box_img">
          <img src="image/falls/2.jpg">
        </div>
      </div>
      <div class="box">
        <div class="box_img">
          <img src="image/falls/3.jpg">
        </div>
      </div>
      <div class="box">
        <div class="box_img">
          <img src="image/falls/4.jpg">
        </div>
      </div>
      <div class="box">
        <div class="box_img">
          <img src="image/falls/5.jpg">
        </div>
      </div>
      <div class="box">
        <div class="box_img">
          <img src="image/falls/6.jpg">
        </div>
      </div>
      <div class="box">
        <div class="box_img">
          <img src="image/falls/7.jpg">
        </div>
      </div>
      <div class="box">
        <div class="box_img">
          <img src="image/falls/8.jpg">
        </div>
      </div>
      <div class="box">
        <div class="box_img">
          <img src="image/falls/9.jpg">
        </div>
      </div>
      <div class="box">
        <div class="box_img">
          <img src="image/falls/10.jpg">
        </div>
      </div>


    </div>
</body>
</html>